<div class="page-container" [ngClass]="{'sidebar_is_full': app.sidebarState, 'sidebar_is_small': !app.sidebarState}">

    <!-- Content Wrapper START -->
    <div class="main-content container">

        <div class="row mt-4">
            <div class="col-md-8 border container p-4">

                <div class="d-flex justify-content-between">
                    <h5>Lista de contratos</h5><br>
                    <button class="btn btn-sm btn-success" (click)="iniciarDocumento()">Crear documento</button>
                </div>
                <div class="row">

                    <div class="list-group" id="list-tab" role="tablist">

                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Nombre documento</th>
                                    <th scope="col">Ultima actualización</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let contrato of contratos; let i = index"
                                    (click)="seleccionarContrato(contrato);">
                                    <th scope="row">{{i+1}}</th>
                                    <td>
                                        {{contrato.Nombre}}
                                    </td>
                                    <td>{{contrato.fch_upd || contrato.fch_add}}</td>
                                    <th>
                                        <button class="btn btn-outline-primary"
                                            (click)="previsualizarMachote(contrato.IdContrato)">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </th>
                                </tr>

                            </tbody>
                        </table>
                        <div class="d-flex justify-content-center" *ngIf="isLoading">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Content Wrapper END -->

    <!-- Footer START -->
    <app-footer></app-footer>
    <!-- Footer END -->

</div>

<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
    <div class="offcanvas-header">
        <h2 class="pul-heading pul-heading--h2 pul-drawer__title"><span>Editor de texto</span></h2>
        <hr>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="ms-2 permissions__subtitle"><span><span class="pul-icon pul-icon--size-24"><img
                    src="https://admiring-davinci.74-208-25-239.plesk.page:8443/cp/theme//icons/16/plesk/file-webscript.png?b2aff14c14b05cccbb316c37d48fb591"
                    alt=""></span> </span>
        <ul class="nav nav-pills" id="pills-tab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link ms-2 active" id="pills-home-tab" data-bs-toggle="pill"
                    (click)="this.celdaSeleccionada=null" data-bs-target="#pills-home" type="button" role="tab"
                    aria-controls="pills-home" aria-selected="true">{{machoteSeleccionado?.Nombre}}</button>
            </li>
            <li class="nav-item" role="presentation" *ngFor="let celda of listaDeCeldas">
                <button class="nav-link" [id]="'pills_celda_tab'+celda.IdCelda" data-bs-toggle="pill"
                    [attr.data-bs-target]="'#pills_celda'+celda.IdCelda" type="button" role="tab"
                    [attr.aria-controls]="'pills_celda'+celda.IdCelda" (click)="seleccionarCelda(celda)"
                    aria-selected="true">{{celda.NombreCelda}}</button>
            </li>
        </ul>
        <button type="button" class="btn btn-light" title="Añadir celda (Clausula, Chepina, Generales)"
            (click)="anadirCelda()"><i class="fas fa-plus"></i></button>
    </div>
    <hr>
    <div class="offcanvas-body">

        <div class="tab-content" id="pills-tabContent">
            <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
                <ckeditor data="{{machoteSeleccionado?.Machote}}" editorUrl="https://ckeditor.com/latest/ckeditor.js"
                    (change)="onChangeEditor($event)" [config]="editorCOnfig"></ckeditor>
            </div>

            <div *ngFor="let celda of listaDeCeldas" class="tab-pane fade" id="pills_celda{{celda.IdCelda}}"
                role="tabpanel" [attr.aria-labelledby]="'pills_celda_tab'+celda.IdCelda">
                <div class="d-flex justify-content-between align-content-center">
                    <span (click)="copiarIdentificadorCelda()" style="cursor: pointer;">Identificador para machote:
                        <strong>{{celda.Identificador}}</strong></span>

                    <button class="btn btn-sm btn-danger" (click)="eliminarCeldaSeleccionada()">
                        Eliminar celda
                    </button>

                </div>
                <br> <br>
                <ckeditor data="{{celda.ContenidoCelda}}" editorUrl="https://ckeditor.com/latest/ckeditor.js"
                    (change)="onChangeCelda($event)" [config]="editorCOnfig"></ckeditor>
            </div>
        </div>

    </div>
    <footer class="pul-drawer__footer">
        <div class="pul-drawer__footer-inner">
            <div class="pul-section pul-form__footer">
                <div class="pul-section-item pul-form-field">
                    <div class="pul-section-item__title">
                        <div class="pul-form-field__label"><label></label></div>
                    </div>
                    <div class="pul-section-item__value">
                        <div>
                            <button class="pul-button pul-button--lg pul-button--primary bg-info text-white"
                                type="button" data-action="submit" (click)="save()" [disabled]="buttonAction"><span
                                    class="pul-button__inner"><span><span>Guardar</span></span></span></button>
                            <button class="pul-button pul-button--lg pul-button--primary bg-primary text-white"
                                type="button" data-action="submit" (click)="saveAll()" [disabled]="buttonAction"><span
                                    class="pul-button__inner"><span><span>Guardar todo</span></span></span></button>
                            <button class="pul-button pul-button--lg" type="button" data-action="apply"
                                (click)="saveAndClose()" [disabled]="buttonAction"><span
                                    class="pul-button__inner"><span><span>Guardar y
                                            salir</span></span></span></button>
                            <button class="pul-button pul-button--lg" type="button" data-action="saveAs"
                                (click)="saveAs()"><span class="pul-button__inner"><span><span>Guardar
                                            como...</span></span></span></button>
                            <button class="pul-button pul-button--lg" type="button" data-bs-dismiss="offcanvas"><span
                                    class="pul-button__inner"><span><span>Cancelar</span></span></span></button>
                            <button class="pul-button pul-button--lg pul-button--primary bg-success text-white" (click)="previsualizarMachote(machoteSeleccionado.IdContrato)">
                                Previsualizar <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
</div><!--  -->
